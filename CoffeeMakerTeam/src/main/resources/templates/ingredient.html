<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<title>Add Ingredient</title>
	<meta http-equiv="Content-Type" />
	<meta name="viewport" content="width=device-width, initial-scale=1, charset=UTF-8">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
	<link rel="stylesheet" href="css/app.css" />
	<link
		href="https://fonts.googleapis.com/css2?family=Montserrat&family=Open+Sans+Condensed:ital,wght@1,300&display=swap"
		rel="stylesheet">
</head>

<body>

	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
		crossorigin="anonymous"></script>

	<script>

		/*<![CDATA[*/
		var app = angular.module('myApp', []);
		app.controller('ingredientCtrl', function ($scope, $http) {

			/* Define the Ingredient Model */
			$scope.ingredient = {

				"name": ""

			};
			$scope.amount = null;
			$scope.message = "";

			$scope.submitIngredient = function () {

				if (hasAllFields()) {

					let body = {};

					body.ingredient = $scope.ingredient.name;
					body.user = JSON.parse(sessionStorage.getItem("currentUser"));
					
					let config = {
						
						"params": {
							"amount": $scope.amount
						}
						
					}


					//API Call
					//UPDATE ingredients (and as a side effect, the inventory)
					$http.post("/api/v1/ingredients/", body, config).then(function (successResponse) {

						// Reset the form if successful.
						$scope.reset();

						// Save the message in scope and display it in html
						$scope.message = successResponse.data.message;

					}, function (errorResponse) {

						// Save the message in scope and display it in html
						$scope.message = errorResponse.data.message;
					});

					// Cool animation for the message changing
					animateMessage();

				}



			};


			/**
			 * Resets the form
			 */
			$scope.reset = function () {
				// Reset the recipe
				$scope.ingredient = {

					"name": "",
				};

				$scope.amount = null;
				$scope.message = "";


			}


			function hasAllFields() {
				//Negative quantity check is done by the front end form logic, this just checks that it has not been 
				//left blank
				if ($scope.ingredient.name != "" && $scope.amount != null && $scope.amount != undefined) {
					return true;
				}

				return false;
			};

			// Animate the message changing.
			function animateMessage() {

				// Refrenced this: https://stackoverflow.com/a/58353279
				const element = document.getElementById('message')

				element.classList.remove('messageAnimation'); // reset animation
				void element.offsetWidth; // trigger reflow
				element.classList.add('messageAnimation'); // start animation
			};


		});

	</script>
	
	<style>
		.messageAnimation {
			animation-name: jump-shaking;
			animation-duration: 0.83s;
			animation-timing-function: ease-in-out;
		}

		@keyframes inAndOut {

			0% {
				background-color: rgba(66, 148, 226, 0);
				color: black;

			}

			50% {
				background-color: rgba(66, 148, 226, 1);
				color: white;
			}

			100% {
				background-color: rgba(66, 148, 226, 0);
				color: black;
			}

		}

		/* Referenced this: https://unused-css.com/blog/css-shake-animation/ */
		@keyframes jump-shaking {
			0% {
				transform: translateX(0)
			}

			25% {
				transform: translateY(-9px)
			}

			35% {
				transform: translateY(-9px) rotate(2deg)
			}

			55% {
				transform: translateY(-9px) rotate(-2deg)
			}

			65% {
				transform: translateY(-9px) rotate(2deg)
			}

			75% {
				transform: translateY(-9px) rotate(-2deg)
			}

			100% {
				transform: translateY(0) rotate(0)
			}
		}
	</style>
	
	<div class="ms-3 mt-3" ng-app="myApp" ng-controller="ingredientCtrl">
		<h1 class="ms-3">Add Ingredient</h1>

		<form>
			<div class="ms-3 mb-1 w-75">
				<label for="ingredient-name" class="form-label">Name</label>
				<input ng-model="ingredient.name" type="text" class="form-control" placeholder="Ingredient Name"
					id="ingredient-name" aria-describedby="ingredientName" required>

			</div>
			<div class="ms-3 mb-3 w-75">
				<label for="ingredient-quantity" class="form-label">Quantity</label>
				<input type="number" class="form-control" ng-model="amount" placeholder="0" id="ingredient-quantity" required min="0">
			</div>

			
			<div class="row w-75 ms-3">
				<div class="col p-0">
					<button type="submit" class="btn btn-primary btn-sm" ng-click="submitIngredient()">Submit</button>

					<button type="button" class="btn btn-secondary btn-sm" ng-click="reset()">Reset</button>
				</div>

				<div class="col p-0">
					<a href="/managerindex" class="btn btn-secondary btn-sm float-end">Home</a>
				</div>
			</div>
			
		</form>
	

		<div class="col m-3 w-75">
			<label id="message" style="border-radius: 5px;" class="fs-6 p-1">{{message}}</label>
		</div>
	
	</div>

</body>